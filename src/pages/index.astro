---
import Header from "../components/Header.astro";
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <Header />

  <section class="min-h-dvh grid place-items-center" id="home">
    <div class="w-3/4 h-2/3 border border-dashed relative bg-background">
      <div class="absolute top-0 start-0 size-2 bg-foreground -translate-1/2"></div>
      <div class="absolute top-0 end-0 size-2 bg-foreground -translate-y-1/2 translate-x-1/2"></div>
      <div class="absolute bottom-0 end-0 size-2 bg-foreground translate-y-1/2 translate-x-1/2"></div>
      <div class="absolute bottom-0 start-0 size-2 bg-foreground translate-y-1/2 -translate-x-1/2"></div>

      <canvas id="splash-wave-canvas" class="size-full"></canvas>
    </div>
  </section>

  <section class="sticky top-0 min-h-dvh px-4 grid place-items-center">
    <div class="w-3/4 h-2/3 border border-dashed relative bg-background">
      <div class="absolute top-0 start-0 size-2 bg-foreground -translate-1/2"></div>
      <div class="absolute top-0 end-0 size-2 bg-foreground -translate-y-1/2 translate-x-1/2"></div>
      <div class="absolute bottom-0 end-0 size-2 bg-foreground translate-y-1/2 translate-x-1/2"></div>
      <div class="absolute bottom-0 start-0 size-2 bg-foreground translate-y-1/2 -translate-x-1/2"></div>

      <div class="relative size-full">
        <canvas id="moire-canvas" class="size-full absolute inset-0 pointer-events-none"></canvas>
        <canvas id="repel-canvas" class="size-full absolute inset-0 pointer-events-none"></canvas>
        <canvas id="wave-canvas" class="size-full border-0 block absolute inset-0"></canvas>
      </div>
    </div>
  </section>

  <section class="min-h-dvh px-4 grid place-items-center" id="projects" data-wave-text="WORKS"></section>
  <section class="min-h-dvh px-4 grid place-items-center" id="projects" data-wave-text="PROJECTS"></section>
  <section class="min-h-dvh px-4 grid place-items-center" id="about" data-wave-text="ABOUT"></section>

  <footer class="min-h-dvh px-4 grid place-items-center" id="contact">
    <h2 class="font-body text-9xl tracking-tighter">Contact</h2>
  </footer>
</Layout>

<script>
  import { SplashWaveScene } from "../lib/canvas-2d/splash-wave";
  import { MoireCanvas } from "../lib/lines-repel/moire";
  import { LinesRepelScene } from "../lib/lines-repel/lines-repel-scene";
  import { WaveScene } from "../lib/wave/wave-scene";
  import { gsap } from "gsap";

  const canvas = document.getElementById("splash-wave-canvas") as HTMLCanvasElement;
  const splash = new SplashWaveScene(canvas);
  splash.mount();

  const waveCanvas = document.getElementById("wave-canvas") as HTMLCanvasElement;
  const scene = new WaveScene({ canvas: waveCanvas });
  scene.start();

  const moireCanvas = document.getElementById("moire-canvas") as HTMLCanvasElement;
  const moire = new MoireCanvas(moireCanvas, { lineSpacing: 30 });
  moire.start();

  const repelCanvas = document.getElementById("repel-canvas") as HTMLCanvasElement;
  const repel = new LinesRepelScene(repelCanvas, { configLines: { spacing: 30 } });
  repel.start();

  window.addEventListener("beforeunload", () => {
    splash.unmount();
    moire.dispose();
    scene.dispose();
  });

  gsap.ticker.add(() => {
    const { x, y, radius } = scene.getLensCSS();
    repel.setRepellerPosition({ x, y }, radius);
  });
</script>
