---
import Frame from "../../components/grid/Frame.astro";
import GridLayout from "../../components/grid/GridLayout.astro";
import { getLangFromURL, useTranslations } from "../../i18n/utils";
import Layout from "../../layouts/Layout.astro";

const lang = getLangFromURL(Astro.url);
const t = useTranslations(lang);

export async function getStaticPaths() {
	return [{ params: { locale: "en" } }, { params: { locale: "fr" } }];
}
---

<Layout>
  <div
    data-lens
    class="absolute inset-0 size-(--lens-radius) rounded-full z-10 border border-dashed pointer-events-none"
  >
  </div>
  <main>
    <section data-section="home" class="px-12">
      <GridLayout class="h-[50vh]">
        <Frame class="col-span-full" />
      </GridLayout>
    </section>
  </main>
</Layout>

<script>
  import { gsap } from "gsap";

  function setupLens() {
    const root = document.documentElement;
    const lens = document.querySelector<HTMLDivElement>("[data-lens]");
    if (!lens) return;

    const radius = 150;
    let isHidden = true;
    let tween: gsap.core.Tween | null = null;

    root.style.setProperty("--lens-radius", `${radius}px`);

    const handleMouseMove = (event: MouseEvent) => {
      const mouseX = event.clientX;
      const mouseY = event.clientY;

      // CSS vars globales pour le reste du layout (parallax, mask, etc.)
      root.style.setProperty("--lens-x", `${mouseX}px`);
      root.style.setProperty("--lens-y", `${mouseY}px`);

      if (isHidden) {
        gsap.to(lens, { opacity: 1, duration: 0.25, ease: "power2.out" });
        isHidden = false;
      }

      tween?.kill();
      tween = gsap.to(lens, {
        x: mouseX - radius / 2,
        y: mouseY - radius / 2,
        duration: 0.75,
        ease: "elastic.out(1, 0.25)",
        overwrite: "auto",
      });
    };

    const handleMouseLeave = () => {
      gsap.to(lens, { opacity: 0, duration: 0.25 });
      isHidden = true;
    };

    window.addEventListener("mousemove", handleMouseMove, { passive: true });
    window.addEventListener("mouseleave", handleMouseLeave);
  }

  setupLens();
</script>
