<canvas data-pixi class="block size-full absolute inset-0"></canvas>

<script>
  import { Application, Text } from "pixi.js";
  import { onThemeChange, parseColor } from "../lib/theme";

  function getCanvas() {
    const canvas = document.querySelector<HTMLCanvasElement>("[data-pixi]");
    if (!canvas) throw new Error("Canvas not found");
    return canvas;
  }

  function getCurrentColor() {
    const style = getComputedStyle(document.body);
    return parseColor(style.getPropertyValue("--color-foreground"));
  }

  async function initPixi() {
    const canvas = getCanvas();
    const app = new Application();

    await app.init({
      canvas: canvas,
      width: canvas.width,
      height: canvas.height,
      backgroundColor: getCurrentColor(),
      resolution: window.devicePixelRatio || 1,
      antialias: true,
      resizeTo: canvas.parentElement || window,
    });

    return app;
  }

  const app = await initPixi();

  onThemeChange(() => {
    app.renderer.background.color = getCurrentColor();
  });
</script>
