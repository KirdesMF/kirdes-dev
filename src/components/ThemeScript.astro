---
// Theme script
---

<script is:inline>
  (function () {
    const root = document.documentElement;

    // 1️⃣ Decide initial theme
    const stored = localStorage.getItem("theme");
    const systemPrefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
    const isDark = stored ? stored === "dark" : systemPrefersDark;

    root.style.colorScheme = isDark ? "dark" : "light";
    // 2️⃣ Apply instantly before render (prevents FOUC)
    root.classList.toggle("dark", isDark);

    // 3️⃣ Keep localStorage synced when class changes
    const observer = new MutationObserver(() => {
      const darkMode = root.classList.contains("dark");
      localStorage.setItem("theme", darkMode ? "dark" : "light");
    });
    observer.observe(root, { attributes: true, attributeFilter: ["class"] });
  })();
</script>
