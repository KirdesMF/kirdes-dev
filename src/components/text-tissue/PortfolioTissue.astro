---
interface Props {
	frequency?: number;
	amplitude?: number;
	speed?: number;
	rotation?: number;
	class?: string;
}

const {
	frequency = 0.5,
	amplitude = 60,
	speed = 0.1,
	rotation = 45,
	class: className,
} = Astro.props;
---

<div
	class:list={["portfolio-tissue-container w-full h-full overflow-hidden relative", className]}
	data-frequency={frequency}
	data-amplitude={amplitude}
	data-speed={speed}
	data-rotation={rotation}
>
	{
    import.meta.env.DEV && (
      <div class="absolute top-4 right-4 z-50 bg-white/80 p-4 rounded shadow-lg backdrop-blur-sm w-64">
        <h3 class="text-sm font-bold mb-3 text-black">Dev Controls</h3>
        <div class="flex flex-col gap-3">
          <label class="text-xs text-black flex flex-col gap-1">
            <div class="flex justify-between">
              <span>Frequency</span>
              <span id="freq-val">{frequency}</span>
            </div>
            <input type="range" id="freq-slider" min="0.1" max="2.0" step="0.1" value={frequency} class="w-full" />
          </label>
          <label class="text-xs text-black flex flex-col gap-1">
            <div class="flex justify-between">
              <span>Amplitude</span>
              <span id="amp-val">{amplitude}</span>
            </div>
            <input type="range" id="amp-slider" min="0" max="300" step="1" value={amplitude} class="w-full" />
          </label>
          <label class="text-xs text-black flex flex-col gap-1">
            <div class="flex justify-between">
              <span>Speed</span>
              <span id="speed-val">{speed}</span>
            </div>
            <input type="range" id="speed-slider" min="0" max="0.5" step="0.01" value={speed} class="w-full" />
          </label>
          <label class="text-xs text-black flex flex-col gap-1">
            <div class="flex justify-between">
              <span>Rotation</span>
              <span id="rot-val">{rotation}</span>
            </div>
            <input type="range" id="rot-slider" min="0" max="360" step="1" value={rotation} class="w-full" />
          </label>
        </div>
      </div>
    )
  }
</div>

<script>
	import { PortfolioTissue } from "./text-tissue";

	// Initialize all instances
	const containers = document.querySelectorAll(".portfolio-tissue-container");
	containers.forEach((container) => {
		if (container instanceof HTMLElement) {
			const tissue = new PortfolioTissue(container);

			// Dev controls
			if (import.meta.env.DEV) {
				const freqSlider = container.querySelector("#freq-slider");
				const ampSlider = container.querySelector("#amp-slider");
				const speedSlider = container.querySelector("#speed-slider");

				const freqVal = container.querySelector("#freq-val");
				const ampVal = container.querySelector("#amp-val");
				const speedVal = container.querySelector("#speed-val");

				if (freqSlider && freqVal) {
					freqSlider.addEventListener("input", (e) => {
						const val = parseFloat((e.target as HTMLInputElement).value);
						tissue.frequency = val;
						freqVal.textContent = val.toFixed(1);
					});
				}

				if (ampSlider && ampVal) {
					ampSlider.addEventListener("input", (e) => {
						const val = parseFloat((e.target as HTMLInputElement).value);
						tissue.amplitude = val;
						ampVal.textContent = val.toFixed(0);
					});
				}

				if (speedSlider && speedVal) {
					speedSlider.addEventListener("input", (e) => {
						const val = parseFloat((e.target as HTMLInputElement).value);
						tissue.speed = val;
						speedVal.textContent = val.toFixed(2);
					});
				}

				const rotSlider = container.querySelector("#rot-slider");
				const rotVal = container.querySelector("#rot-val");
				if (rotSlider && rotVal) {
					rotSlider.addEventListener("input", (e) => {
						const val = parseFloat((e.target as HTMLInputElement).value);
						tissue.rotation = val;
						rotVal.textContent = val.toFixed(0);
					});
				}
			}

			// Cleanup on swap
			document.addEventListener(
				"astro:before-swap",
				() => {
					tissue.destroy();
				},
				{ once: true },
			);
		}
	});
</script>
